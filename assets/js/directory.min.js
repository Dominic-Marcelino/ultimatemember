function um_get_data_for_directory(e,t){var r=UM.frontend.directories.getHash(e),a={},i=UM.frontend.url.parseData();if(jQuery.each(i,function(e){-1!==e.indexOf("_"+r)&&""!==i[e]&&(a[e.replace("_"+r,"")]=i[e])}),t){if(void 0!==a[t])try{a[t]=decodeURIComponent(a[t])}catch(e){console.error(e)}return a[t]}return a}function um_set_url_from_data(e,t,r){var a=UM.frontend.directories.getHash(e),i=um_get_data_for_directory(e),n={},o=(Array.isArray(r)?(jQuery.each(r,function(e){r[e]=encodeURIComponent(r[e])}),r=r.join("||")):Number.isFinite(r)||(r=r.split("||"),jQuery.each(r,function(e){r[e]=encodeURIComponent(r[e])}),r=r.join("||")),""!==r&&(n[t+"_"+a]=r),jQuery.each(i,function(e){t===e?""!==r&&(n[e+"_"+a]=r):n[e+"_"+a]=i[e]}),jQuery.each(UM.frontend.directories.list,function(e){let t=UM.frontend.directories.list[e].getHash();var r;t!==a&&(r=um_get_data_for_directory(jQuery('.um-directory[data-hash="'+t+'"]')),jQuery.each(r,function(e){n[e+"_"+t]=r[e]}))}),[]),e=(jQuery.each(n,function(e){o.push(e+"="+n[e])}),"?"+(o=wp.hooks.applyFilters("um_member_directory_url_attrs",o)).join("&"));"?"===e&&(e=""),window.history.pushState("string","UM Member Directory",window.location.origin+window.location.pathname+e)}function um_get_search(e){return e.find(".um-search-line").length?e.find(".um-search-line").val():""}function um_time_convert(e,t){var r=Math.floor(e/60),e=e%60;return(r=60<=e&&(e=0,24<=(r+=1))?0:r)+":"+(e=e<10?"0"+e:e)}function um_build_template(e,t){var r=e.data("view_type"),a=UM.frontend.directories.getHash(e);jQuery(".um-"+a).length&&(e.find(".um-members-wrapper").html("").prepend(t["content_"+r]),""!==t.counter?e.find(".um-members-counter").text(t.counter).show():e.find(".um-members-counter").text(t.counter).hide(),e.addClass("um-loaded"),jQuery(document).trigger("um_build_template",[e,t]),jQuery(window).trigger("resize"),wp.hooks.doAction("um_member_directory_build_template",e),UM.common.tipsy.init())}function um_get_filters_data(d){var u=[];return d.find(".um-search-filter").each(function(){var o,r,a,i,e,t,n,s=jQuery(this);s.find("input.um-datepicker-filter").length?(o="datepicker",s.find("input.um-datepicker-filter").each(function(){var e,t,r,a,i,n;"to"!==jQuery(this).data("range")&&(e=jQuery(this).data("filter_name"),t=um_get_data_for_directory(d,"filter_"+e+"_from"),r=um_get_data_for_directory(d,"filter_"+e+"_to"),void 0!==t||void 0!==r)&&((a=jQuery(this).val())===(i=d.find('input.um-datepicker-filter[data-range="to"][data-filter_name="'+e+'"]').val())?n=i:""!==a&&""!==i?n=a+" - "+i:""===a?n="before "+i:""===i&&(n="since "+a),u.push({name:e,label:jQuery(this).data("filter-label"),value_label:n,value:[t,r],type:o}))})):s.find("input.um-timepicker-filter").length?(o="timepicker",s.find("input.um-timepicker-filter").each(function(){var e,t,r,a,i,n;"to"!==jQuery(this).data("range")&&(e=jQuery(this).data("filter_name"),t=um_get_data_for_directory(d,"filter_"+e+"_from"),r=um_get_data_for_directory(d,"filter_"+e+"_to"),void 0!==t||void 0!==r)&&((a=jQuery(this).val())===(i=d.find('input.um-timepicker-filter[data-range="to"][data-filter_name="'+e+'"]').val())?n=i:""!==a&&""!==i?n=a+" - "+i:""===a?n="before "+i:""===i&&(n="since "+a),u.push({name:e,label:jQuery(this).data("filter-label"),value_label:n,value:[t,r],type:o}))})):s.find("select").length?(o="select",r=s.find("select").attr("name"),a=s.find("select").data("placeholder"),i=void 0===(i=um_get_data_for_directory(d,"filter_"+r))?[]:(i=UM.common.form.unsanitizeValue(i)).split("||"),jQuery.each(i,function(e){var t=s.find('select option[value="'+i[e]+'"]').data("value_label");u.push({name:r,label:a,value_label:t,value:i[e],type:o})})):s.hasClass("um-text-filter-type")&&s.find('input[type="text"]').length?(o="text",r=s.find('input[type="text"]').attr("name"),a=s.find('input[type="text"]').attr("placeholder"),""!=(i=void 0===(i=um_get_data_for_directory(d,"filter_"+r))?"":i)&&u.push({name:r,label:a,value_label:i,value:i,type:o})):s.find("div.ui-slider").length?(o="slider",r=s.find("div.ui-slider").data("field_name"),e=um_get_data_for_directory(d,"filter_"+r+"_from"),t=um_get_data_for_directory(d,"filter_"+r+"_to"),void 0===e&&void 0===t||(n=(e===t?s.find("div.um-slider-range").data("placeholder-s").replace("{value}",e):s.find("div.um-slider-range").data("placeholder-p").replace("{min_range}",e).replace("{max_range}",t)).replace("{field_label}",s.find("div.um-slider-range").data("label")),a=s.find("div.um-slider-range").data("label"),u.push({name:r,label:a,value_label:n,value:[e,t],type:o}))):u=wp.hooks.applyFilters("um_member_directory_get_filter_data",u,d,s)}),u}"object"!=typeof window.UM&&(window.UM={}),"object"!=typeof UM.frontend&&(UM.frontend={}),UM.frontend.directories={list:[],getHash:function(e){return e.data("hash")},filtersHash:function(t){let r=0;for(let e=0;e<t.length;e++){var a=t.charCodeAt(e);r=(r<<5)-r+a,r|=0}return r},filters:{checkEmpty:function(e){var t=e.find(".um-clear-filters-a"),e=e.find(".um-search-filter-field");let a=0;return e.each(function(){var e,t,r=jQuery(this).parents(".um-search-filter").data("filter-type");"text"===r?""===jQuery(this).val()&&a++:"select"===r?0===jQuery(this).val().length&&a++:"slider"===r?(t=(e=jQuery(this).parents(".um-range-container")).find(".um-from-slider")[0],e=e.find(".um-to-slider")[0],parseInt(t.value,10)===parseInt(t.min,10)&&parseInt(e.value,10)===parseInt(e.max,10)&&a++):"datepicker"===r?(e=(t=jQuery(this).parents(".um-date-range-row")).find('[data-range="from"]'),t=t.find('[data-range="to"]'),""===e.val()&&""===t.val()&&a++):"timepicker"===r&&(t=(e=jQuery(this).parents(".um-time-range-row")).find('[data-range="from"]'),r=e.find('[data-range="to"]'),""===t.val())&&""===r.val()&&a++}),e.length===a?t.addClass("um-hidden").prop("disabled",!0):t.removeClass("um-hidden").prop("disabled",!1),e.length===a}}},UM.frontend.directory=function(e){this.hash=e,this.wrapper=jQuery('.um-directory[data-hash="'+e+'"]'),this.defaultOrder=this.wrapper.data("default-order")},UM.frontend.directory.prototype={hash:"",wrapper:null,busy:!1,lastResponse:null,page:1,search:"",order:"",defaultOrder:"",filters:{},getDataFromURL:function(e){let t=this.hash,r={},a=UM.frontend.url.parseData();if(jQuery.each(a,function(e){-1!==e.indexOf("_"+t)&&""!==a[e]&&(r[e.replace("_"+t,"")]=a[e])}),!e)return r;if(void 0!==r[e])try{r[e]=decodeURIComponent(r[e])}catch(e){console.error(e)}return r[e]},setDataToURL:function(t,r){let a=this.hash,i=this.getDataFromURL(),n={},o=(Array.isArray(r)?(jQuery.each(r,function(e){r[e]=encodeURIComponent(r[e])}),r=r.join("||")):Number.isFinite(r)||(r=r.split("||"),jQuery.each(r,function(e){r[e]=encodeURIComponent(r[e])}),r=r.join("||")),""!==r&&(n[t+"_"+a]=r),jQuery.each(i,function(e){t===e?""!==r&&(n[e+"_"+a]=r):n[e+"_"+a]=i[e]}),jQuery.each(UM.frontend.directories.list,function(r){if(r!==a){let t=UM.frontend.directories.list[r].getDataFromURL();jQuery.each(t,function(e){n[e+"_"+r]=t[e]})}}),[]),e=(jQuery.each(n,function(e){o.push(e+"="+n[e])}),"?"+(o=wp.hooks.applyFilters("um_member_directory_url_attrs",o)).join("&"));"?"===e&&(e=""),window.history.pushState("string","UM Member Directory",window.location.origin+window.location.pathname+e)},setLastResponse:function(e){this.lastResponse=e},getLastResponse:function(){return this.lastResponse},isBusy:function(){return this.busy},getHash:function(){return this.hash},getWrapper:function(){return this.wrapper},preloaderShow:function(){this.busy=!0,this.wrapper.addClass("um-processing")},preloaderHide:function(){this.busy=!1,this.wrapper.removeClass("um-processing")},getPage:function(){return this.page},setPage:function(e){e=parseInt(e),this.wrapper.data("page",e=e||1),1===(this.page=e)?this.setDataToURL("page",""):this.setDataToURL("page",e)},getOrder:function(){return this.order},setOrder:function(e){this.wrapper.data("sorting",e),this.order=e,this.defaultOrder===e?this.setDataToURL("sort",""):this.setDataToURL("sort",e)},getSearch:function(){return this.search},setSearch:function(e){this.wrapper.data("general_search",e),""===(this.search=e)?this.setDataToURL("search",""):this.setDataToURL("search",e)},hasSearched:function(){return this.getSearch()&&this.getFilters().length},getFilters:function(){return this.filters},applyFilters:function(){let s=this;var e=s.wrapper.find(".um-filters-form").find(".um-search-filter-field");let d={};e.each(function(){var r=jQuery(this).parents(".um-search-filter"),e=r.data("filter-type"),r=r.data("filter-name");if("text"===e){var a=UM.common.form.sanitizeValue(jQuery(this).val());""!==a&&(d[r]=a),s.setDataToURL("filter_"+r,a)}else if("select"===e){var i=jQuery(this).val();let t=[];for(let e=0;e<i.length;e++)t[e]=UM.common.form.sanitizeValue(i[e]);0!==t.length&&(d[r]=t),t=t.length?t.join("||"):"",s.setDataToURL("filter_"+r,t)}else if("slider"===e){var a=jQuery(this).parents(".um-range-container"),n=a.find(".um-from-slider")[0],a=a.find(".um-to-slider")[0],o=parseInt(n.value,10);let e;e=parseInt(n.value,10)===parseInt(n.min,10)?"":parseInt(n.value,10);var n=parseInt(a.value,10);let t;t=parseInt(a.value,10)===parseInt(a.max,10)?"":parseInt(a.value,10),""===e&&""===t||(d[r]=[o,n]),s.setDataToURL("filter_"+r+"_from",e),s.setDataToURL("filter_"+r+"_to",t)}else"datepicker"===e?(o=(a=jQuery(this).parents(".um-date-range-row")).find('[data-range="from"]'),n=a.find('[data-range="to"]'),a=UM.common.form.sanitizeValue(o.val()),o=UM.common.form.sanitizeValue(n.val()),""===a&&""===o||(d[r]=[a,o]),s.setDataToURL("filter_"+r+"_from",a),s.setDataToURL("filter_"+r+"_to",o)):"timepicker"===e&&(a=(n=jQuery(this).parents(".um-time-range-row")).find('[data-range="from"]'),o=n.find('[data-range="to"]'),e=UM.common.form.sanitizeValue(a.val()),n=UM.common.form.sanitizeValue(o.val()),""===e&&""===n||(d[r]=[e,n]),s.setDataToURL("filter_"+r+"_from",e),s.setDataToURL("filter_"+r+"_to",n))}),this.filters=d},resetFilters:function(){this.filters={};let r=this,a=r.wrapper;a.find(".um-filters-form").find(".um-search-filter-field").each(function(){var e=jQuery(this).parents(".um-search-filter"),t=e.data("filter-type"),e=e.data("filter-name");"text"===t?r.setDataToURL("filter_"+e,""):"select"===t?r.setDataToURL(a,"filter_"+e,""):"slider"!==t&&"datepicker"!==t&&"timepicker"!==t||(r.setDataToURL(a,"filter_"+e+"_from",""),r.setDataToURL(a,"filter_"+e+"_to",""))})},request:function(e){if(this.preloaderShow(),wp.hooks.applyFilters("um_member_directory_get_members_allow",!0,this)){var r,a=-(new Date).getTimezoneOffset()/60,i={directory_id:this.getHash(),page:this.getPage(),search:this.getSearch(),sorting:this.getOrder(),gmt_offset:a,post_refferer:this.wrapper.data("base-post"),nonce:this.wrapper.data("nonce")},n=(console.log(this.getFilters()),this.getFilters());for(r in n)i[r]=n[r];i=wp.hooks.applyFilters("um_member_directory_filter_request",i);let t=this;wp.ajax.send("um_get_members",{data:i,success:function(e){t.setLastResponse(e),um_build_template(t.wrapper,e),t.wrapper.find(".um-members-pagination-box").html(e.pagination),t.wrapper.data("total_pages",e.total_pages),e.total_pages?(t.wrapper.find(".um-member-directory-sorting-options").prop("disabled",!1),t.wrapper.find(".um-member-directory-view-type").removeClass("um-disabled")):(t.wrapper.find(".um-member-directory-sorting-options").prop("disabled",!0),t.wrapper.find(".um-member-directory-view-type").addClass("um-disabled")),wp.hooks.doAction("um_member_directory_loaded",t.wrapper,e),um_init_new_dropdown(),t.preloaderHide()},error:function(e){console.log(e),t.preloaderHide()}})}else setTimeout(this.request,600,e)}},jQuery(document.body).ready(function(){function t(e){var t,r=UM.frontend.directories.getHash(e),r=UM.frontend.directories.list[r];r.isBusy()||(t=r.getDataFromURL("search"),(e=UM.common.form.sanitizeValue(e.find(".um-search-line").val()))===t)||""===e&&void 0===t||(r.setSearch(e),r.setPage(1),r.request())}function o(e,t,r){var a=e.find('.um-pagination-item[data-page="prev"]'),e=e.find('.um-pagination-item[data-page="next"]');(1===t?(a.addClass("disabled"),e):t===r?(e.addClass("disabled"),a):(a.removeClass("disabled"),e)).removeClass("disabled")}jQuery(document.body).on("click",".um-directory .um-member-view-switcher:not(.um-disabled) .um-button-in-group:not(.current)",function(){var e,t=jQuery(this),r=t.parents(".um-directory"),a=UM.frontend.directories.getHash(r),a=UM.frontend.directories.list[a];a.isBusy()||null!==(a=a.getLastResponse())&&(e=t.parents(".um-member-view-switcher").find(".um-button-in-group.current").data("type"),r.find(".um-members-wrapper.um-members-"+e).removeClass("um-members-"+e),t.parents(".um-member-view-switcher").find(".um-button-in-group").removeClass("current"),t.addClass("current"),e=t.data("type"),t=t.data("default"),r.find(".um-members-wrapper").addClass("um-members-"+e),um_set_url_from_data(r,"view_type",t?"":e),r.data("view_type",e),um_build_template(r,a),um_init_new_dropdown())}),jQuery(document.body).on("click",".um-directory .um-do-search",function(){t(jQuery(this).parents(".um-directory"))}),jQuery(document.body).on("keypress",".um-directory .um-search-line",function(e){13===e.which&&t(jQuery(this).parents(".um-directory"))}),jQuery(document.body).on("click",".um-members-sorting",function(e){var t,r,a;e.preventDefault(),1===jQuery(this).data("selected")||(e=jQuery(this).data("directory-hash"),(e=UM.frontend.directories.list[e]).isBusy())||(t=e.getWrapper(),r=jQuery(this).text(),a=jQuery(this).data("value"),t.find('.um-dropdown[data-element=".um-members-sorting-toggle"]').find("a").data("selected",0).prop("data-selected",0).attr("data-selected",0),t.find('.um-dropdown[data-element=".um-members-sorting-toggle"] a[data-value="'+a+'"]').data("selected",1).prop("data-selected",1).attr("data-selected",1),t.find(".um-members-sorting-toggle .um-button-content").text(r),e.setOrder(a),e.request())}),jQuery(document.body).on("click",".um-directory .um-pagination-item:not(.current)",function(){if(!jQuery(this).hasClass("disabled")){var t=jQuery(this).parents(".um-directory"),r=UM.frontend.directories.getHash(t),r=UM.frontend.directories.list[r];if(!r.isBusy()){var a=parseInt(t.data("total_pages")),i=parseInt(t.data("page")),n=jQuery(this).data("page");let e;o(t,e="prev"===n?i-1:"next"===n?i+1:parseInt(n),a),t.find(".um-pagination-item").removeClass("current"),t.find('.um-pagination-item[data-page="'+e+'"]').addClass("current"),r.setPage(e),r.request()}}}),jQuery(document.body).on("change",".um-directory .um-pagination-current-page-input",function(){if(!jQuery(this).hasClass("disabled")){var t=jQuery(this).parents(".um-directory"),r=UM.frontend.directories.getHash(t),r=UM.frontend.directories.list[r];if(!r.isBusy()){var a=parseInt(t.data("page"));let e=parseInt(jQuery(this).val());var i=parseInt(t.data("total_pages"));a!==e&&(e<1&&(jQuery(this).val(1),e=1),e>i&&(jQuery(this).val(i),e=i),o(t,e,i),r.setPage(e),r.request())}}}),jQuery(document.body).on("keypress",".um-directory .um-pagination-current-page-input",function(e){if(13===e.which)return jQuery(this).trigger("change"),!1}),jQuery(document.body).on("change",".um-search-filter-field",function(){var e=jQuery(this).parents(".um-filters-form"),t=e.find(".um-apply-filters");UM.frontend.directories.filters.checkEmpty(e),t.prop("disabled",!1)}),jQuery(document.body).on("reset",".um-directory .um-filters-form",function(){var e,t,r=jQuery(this).parents(".um-directory"),r=UM.frontend.directories.getHash(r),r=UM.frontend.directories.list[r];r.isBusy()||(e=(t=jQuery(this)).find(".um-clear-filters-a"),t=t.find(".um-apply-filters"),e.addClass("um-hidden").prop("disabled",!0),t.prop("disabled",!0),r.resetFilters(),r.setPage(1),r.request())}),jQuery(document.body).on("click",".um-directory .um-apply-filters",function(e){e.preventDefault();e=jQuery(this).parents(".um-directory"),e=UM.frontend.directories.getHash(e),e=UM.frontend.directories.list[e];e.isBusy()||(e.applyFilters(),e.setPage(1),e.request())}),wp.hooks.doAction("um_member_directory_on_first_pages_loading"),jQuery(".um-directory").each(function(){var e=jQuery(this),t=UM.frontend.directories.getHash(e),r=new UM.frontend.directory(t),t=(UM.frontend.directories.list[t]=r,wp.hooks.doAction("um_member_directory_on_init",e,t),wp.hooks.applyFilters("um_member_directory_ignore_after_search",!1,e));if(!t&&1===e.data("must-search")){t=um_get_search(e),e=e.find(".um-filters-form");if(UM.frontend.directories.filters.checkEmpty(e)&&!t)return}var a;wp.hooks.applyFilters("um_member_directory_prevent_default_request",!1,r)||(e=r.getDataFromURL("page"),t=r.getDataFromURL("search"),a=r.getDataFromURL("sort"),r.applyFilters(),r.setPage(e),r.setSearch(t),r.setOrder(a),r.request({defaultRequest:!0}))}),window.addEventListener("popstate",function(e){jQuery(".um-directory").each(function(){var e,t=jQuery(this),r=UM.frontend.directories.getHash(t),a=new UM.frontend.directory(r),i=(UM.frontend.directories.list[r]=a,t.find(".um-members-grid, .um-members-list, .um-members-intro").remove(),t.find(".um-member-directory-search-line").length&&(n=um_get_data_for_directory(t,"search"),t.data("general_search",n=void 0===n?"":n),t.find(".um-search-line").val(n)),um_get_data_for_directory(t,"page")),i=(void 0===i?i=1:i>t.data("total_pages")&&(i=t.data("total_pages")),t.data("page",i).attr("data-page",i),t.find(".um-member-directory-sorting").length&&(void 0===(i=um_get_data_for_directory(t,"sort"))&&(i=t.find('.um-new-dropdown[data-element=".um-member-directory-sorting-a"]').find('a[data-default="1"]').data("value")),t.data("sorting",i),(e=t.find('.um-new-dropdown[data-element=".um-member-directory-sorting-a"]')).find("a").data("selected",0).prop("data-selected",0).attr("data-selected",0),e.find('a[data-value="'+i+'"]').data("selected",1).prop("data-selected",1).attr("data-selected",1),t.find(".um-member-directory-sorting-a").find("> a").html(e.find('a[data-value="'+i+'"]').html())),t.find(".um-member-directory-view-type").length&&(void 0===(e=um_get_data_for_directory(t,"view_type"))&&(e=t.find('.um-member-directory-view-type-a[data-default="1"]').data("type")),t.data("view_type",e),t.find(".um-member-directory-view-type .um-member-directory-view-type-a").hide(),t.find('.um-member-directory-view-type .um-member-directory-view-type-a[data-type="'+e+'"]').show()),wp.hooks.applyFilters("um_member_directory_ignore_after_search",!1,t));if(!i&&1===t.data("must-search")){var n=um_get_search(t);if(!um_get_filters_data(t).length&&!n)return t.data("searched",0),void UM.frontend.directories.list[r].preloaderHide();t.data("searched",1)}wp.hooks.applyFilters("um_member_directory_prevent_default_first_loading",!1,t,r)||a.request()})})}),wp.hooks.addFilter("um_toggle_block","um_member_directory",function(e,t){var r,a;return t.hasClass("um-meta-toggle")?(e=t.parents(".um-member").find(t.data("um-toggle")),r=t.data("toggle-text"),a=t.text(),t.data("toggle-text",a).text(r)):t.hasClass("um-filters-toggle")&&(e=t.parents(".um-directory").find(t.data("um-toggle"))),e});