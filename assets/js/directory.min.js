function um_time_convert(e,r){var t=Math.floor(e/60),e=e%60;return(t=60<=e&&(e=0,24<=(t+=1))?0:t)+":"+(e=e<10?"0"+e:e)}function um_build_template(e,r){var t=e.data("view_type"),a=UM.frontend.directories.getHash(e);jQuery(".um-"+a).length&&(e.find(".um-members-wrapper").html("").prepend(r["content_"+t]),""!==r.counter?e.find(".um-members-counter").text(r.counter).show():e.find(".um-members-counter").text(r.counter).hide(),e.addClass("um-loaded"),jQuery(document).trigger("um_build_template",[e,r]),jQuery(window).trigger("resize"),wp.hooks.doAction("um_member_directory_build_template",e),UM.common.tipsy.init())}"object"!=typeof window.UM&&(window.UM={}),"object"!=typeof UM.frontend&&(UM.frontend={}),UM.frontend.directories={list:[],getHash:function(e){return e.data("hash")},filtersHash:function(r){let t=0;for(let e=0;e<r.length;e++){var a=r.charCodeAt(e);t=(t<<5)-t+a,t|=0}return t},filters:{checkEmpty:function(e){var r=e.find(".um-clear-filters-a"),e=e.find(".um-search-filter-field");let a=0;return e.each(function(){var e,r,t=jQuery(this).parents(".um-search-filter").data("filter-type");"text"===t?""===jQuery(this).val()&&a++:"select"===t?0===jQuery(this).val().length&&a++:"slider"===t?(r=(e=jQuery(this).parents(".um-range-container")).find(".um-from-slider")[0],e=e.find(".um-to-slider")[0],parseInt(r.value,10)===parseInt(r.min,10)&&parseInt(e.value,10)===parseInt(e.max,10)&&a++):"datepicker"===t?(e=(r=jQuery(this).parents(".um-date-range-row")).find('[data-range="from"]'),r=r.find('[data-range="to"]'),""===e.val()&&""===r.val()&&a++):"timepicker"===t&&(r=(e=jQuery(this).parents(".um-time-range-row")).find('[data-range="from"]'),t=e.find('[data-range="to"]'),""===r.val())&&""===t.val()&&a++}),e.length===a?r.addClass("um-hidden").prop("disabled",!0):r.removeClass("um-hidden").prop("disabled",!1),e.length===a}}},UM.frontend.directory=function(e){this.hash=e,this.wrapper=jQuery('.um-directory[data-hash="'+e+'"]'),this.defaultOrder=this.wrapper.data("default-order")},UM.frontend.directory.prototype={hash:"",wrapper:null,busy:!1,lastResponse:null,page:1,totalPages:0,search:"",order:"",defaultOrder:"",filters:{},getDataFromURL:function(e){let r=this.hash,t={},a=UM.frontend.url.parseData();if(jQuery.each(a,function(e){-1!==e.indexOf("_"+r)&&""!==a[e]&&(t[e.replace("_"+r,"")]=a[e])}),!e)return t;if(void 0!==t[e])try{t[e]=decodeURIComponent(t[e])}catch(e){console.error(e)}return t[e]},setDataToURL:function(r,t){let a=this.hash,i=this.getDataFromURL(),s={},n=(Array.isArray(t)?(jQuery.each(t,function(e){t[e]=encodeURIComponent(t[e])}),t=t.join("||")):Number.isFinite(t)||(t=t.split("||"),jQuery.each(t,function(e){t[e]=encodeURIComponent(t[e])}),t=t.join("||")),""!==t&&(s[r+"_"+a]=t),jQuery.each(i,function(e){r===e?""!==t&&(s[e+"_"+a]=t):s[e+"_"+a]=i[e]}),jQuery.each(UM.frontend.directories.list,function(t){if(t!==a){let r=UM.frontend.directories.list[t].getDataFromURL();jQuery.each(r,function(e){s[e+"_"+t]=r[e]})}}),[]),e=(jQuery.each(s,function(e){n.push(e+"="+s[e])}),"?"+(n=wp.hooks.applyFilters("um_member_directory_url_attrs",n)).join("&"));"?"===e&&(e=""),window.history.pushState("string","UM Member Directory",window.location.origin+window.location.pathname+e)},setLastResponse:function(e){this.lastResponse=e},setTotalPages:function(e){this.totalPages=e},getLastResponse:function(){return this.lastResponse},isBusy:function(){return this.busy},getHash:function(){return this.hash},getWrapper:function(){return this.wrapper},preloaderShow:function(){this.busy=!0,this.wrapper.addClass("um-processing")},preloaderHide:function(){this.busy=!1,this.wrapper.removeClass("um-processing")},getPage:function(){return this.page},setPage:function(e,r){let t=!1,a=(void 0!==r&&r.hasOwnProperty("ignoreURL")&&!1!==r.ignoreURL&&(t=!0),!1);(a=void 0!==r&&r.hasOwnProperty("updateUI")&&!1!==r.updateUI?!0:a)&&this.wrapper.find(".um-members-pagination-box").addClass("um-display-none"),e=(e=parseInt(e))||1;r=parseInt(this.wrapper.data("total_pages"));r&&(e=e<=(r=r||1)?e:r),this.page=e,t||(1===e?this.setDataToURL("page",""):this.setDataToURL("page",e))},getOrder:function(){return this.order},setOrder:function(e,r){let t=!1,a=(void 0!==r&&r.hasOwnProperty("ignoreURL")&&!1!==r.ignoreURL&&(t=!0),!1);(a=void 0!==r&&r.hasOwnProperty("updateUI")&&!1!==r.updateUI?!0:a)&&this.wrapper.find(".um-member-directory-sorting").length&&((r=this.wrapper.find('.um-new-dropdown[data-element=".um-member-directory-sorting-a"]')).find("a").data("selected",0).prop("data-selected",0).attr("data-selected",0),r.find('a[data-value="'+e+'"]').data("selected",1).prop("data-selected",1).attr("data-selected",1),this.wrapper.find(".um-member-directory-sorting-a").find("> a").html(r.find('a[data-value="'+e+'"]').html())),this.order=e,t||(this.defaultOrder===e?this.setDataToURL("sort",""):this.setDataToURL("sort",e))},getSearch:function(){return this.search},setSearch:function(e,r){let t=!1,a=(void 0!==r&&r.hasOwnProperty("ignoreURL")&&!1!==r.ignoreURL&&(t=!0),!1);if(void 0!==r&&r.hasOwnProperty("updateUI")&&!1!==r.updateUI&&(a=!0),this.search=e,a){let e=this.getDataFromURL("search");void 0===e&&(e=""),this.wrapper.find(".um-search-line").val(e)}t||(""===e?this.setDataToURL("search",""):this.setDataToURL("search",e))},hasSearched:function(){return""!==this.getSearch()||0!==Object.keys(this.getFilters()).length},getFilters:function(){return this.filters},setFilters:function(o=!1){let d=this;var e=d.wrapper.find(".um-filters-form"),r=e.find(".um-search-filter-field");let m={};r.each(function(){var t=jQuery(this).parents(".um-search-filter"),e=t.data("filter-type"),t=t.data("filter-name");if("text"===e){var a=UM.common.form.sanitizeValue(jQuery(this).val());""!==a&&(m[t]=a),o||d.setDataToURL("filter_"+t,a)}else if("select"===e){var i=jQuery(this).val();let r=[];for(let e=0;e<i.length;e++)r[e]=UM.common.form.sanitizeValue(i[e]);0!==r.length&&(m[t]=r),r=r.length?r.join("||"):"",o||d.setDataToURL("filter_"+t,r)}else if("slider"===e){var a=jQuery(this).parents(".um-range-container"),s=a.find(".um-from-slider")[0],a=a.find(".um-to-slider")[0],n=parseInt(s.value,10);let e;e=parseInt(s.value,10)===parseInt(s.min,10)?"":parseInt(s.value,10);var s=parseInt(a.value,10);let r;r=parseInt(a.value,10)===parseInt(a.max,10)?"":parseInt(a.value,10),""===e&&""===r||(m[t]=[n,s]),o||(d.setDataToURL("filter_"+t+"_from",e),d.setDataToURL("filter_"+t+"_to",r))}else"datepicker"===e?(n=(a=jQuery(this).parents(".um-date-range-row")).find('[data-range="from"]'),s=a.find('[data-range="to"]'),a=UM.common.form.sanitizeValue(n.val()),n=UM.common.form.sanitizeValue(s.val()),""===a&&""===n||(m[t]=[a,n]),o||(d.setDataToURL("filter_"+t+"_from",a),d.setDataToURL("filter_"+t+"_to",n))):"timepicker"===e&&(a=(s=jQuery(this).parents(".um-time-range-row")).find('[data-range="from"]'),n=s.find('[data-range="to"]'),e=UM.common.form.sanitizeValue(a.val()),s=UM.common.form.sanitizeValue(n.val()),""===e&&""===s||(m[t]=[e,s]),o||(d.setDataToURL("filter_"+t+"_from",e),d.setDataToURL("filter_"+t+"_to",s)))}),this.filters=m,UM.frontend.directories.filters.checkEmpty(e)&&e.find(".um-apply-filters").prop("disabled",!0)},resetFilters:function(){this.filters={};let t=this;t.wrapper.find(".um-filters-form").find(".um-search-filter-field").each(function(){var e=jQuery(this).parents(".um-search-filter"),r=e.data("filter-type"),e=e.data("filter-name");"text"===r||"select"===r?t.setDataToURL("filter_"+e,""):"slider"!==r&&"datepicker"!==r&&"timepicker"!==r||(t.setDataToURL("filter_"+e+"_from",""),t.setDataToURL("filter_"+e+"_to",""))})},request:function(e){let r=!1;if((r=void 0!==e&&e.hasOwnProperty("pagination")&&!1!==e.pagination?!0:r)||this.preloaderShow(),this.wrapper.find(".um-member-directory-must-search").addClass("um-display-none"),this.wrapper.find(".um-member-directory-empty-search-result").addClass("um-display-none"),this.wrapper.find(".um-member-directory-empty-no-search-result").addClass("um-display-none"),this.wrapper.find(".um-member-directory-sorting .um-dropdown-wrapper .um-button").prop("disabled",!0),this.wrapper.find(".um-member-view-switcher").addClass("um-disabled"),r?this.wrapper.find(".um-members-wrapper .um-member").addClass("um-skeleton-mode"):(this.wrapper.find(".um-members-wrapper").addClass("um-display-none"),this.wrapper.find(".um-members-pagination-box").addClass("um-display-none")),wp.hooks.applyFilters("um_member_directory_get_members_allow",!0,this)){var t,a=-(new Date).getTimezoneOffset()/60,i={directory_id:this.getHash(),page:this.getPage(),search:this.getSearch(),sorting:this.getOrder(),gmt_offset:a,post_refferer:this.wrapper.data("base-post"),nonce:this.wrapper.data("nonce")},s=(console.log(this.getFilters()),this.getFilters());for(t in s)i[t]=s[t];i=wp.hooks.applyFilters("um_member_directory_filter_request",i);let r=this;wp.ajax.send("um_get_members",{data:i,success:function(e){r.setLastResponse(e),r.setTotalPages(e.total_pages),um_build_template(r.wrapper,e),r.wrapper.find(".um-members-pagination-box").html(e.pagination),r.wrapper.data("total_pages",e.total_pages),e.total_pages?(r.wrapper.find(".um-member-directory-sorting .um-dropdown-wrapper .um-button").prop("disabled",!1),r.wrapper.find(".um-member-view-switcher").removeClass("um-disabled"),r.wrapper.find(".um-member-directory-header").removeClass("um-display-none"),r.wrapper.find(".um-members-wrapper").removeClass("um-display-none"),r.wrapper.find(".um-members-pagination-box").removeClass("um-display-none"),r.wrapper.find(".um-member-directory-header-row-grid").removeClass("um-display-none")):r.hasSearched()?(r.wrapper.find(".um-member-directory-empty-search-result").removeClass("um-display-none"),r.wrapper.find(".um-member-directory-header").removeClass("um-display-none"),r.wrapper.find(".um-member-directory-header-row-grid").addClass("um-display-none")):r.wrapper.find(".um-member-directory-empty-no-search-result").removeClass("um-display-none"),wp.hooks.doAction("um_member_directory_loaded",r.wrapper,e),um_init_new_dropdown(),UM.frontend.slider.init(),r.preloaderHide()},error:function(e){console.log(e),(r.hasSearched()?r.wrapper.find(".um-member-directory-empty-search-result"):r.wrapper.find(".um-member-directory-empty-no-search-result")).removeClass("um-display-none"),r.preloaderHide()}})}else setTimeout(this.request,600,e)}},jQuery(document.body).ready(function(){function r(e){var r=UM.frontend.directories.getHash(e),r=UM.frontend.directories.list[r];if(!r.isBusy()){var t=r.getDataFromURL("search"),a=UM.common.form.sanitizeValue(e.find(".um-search-line").val());if(a!==t&&(""!==a||void 0!==t)){if(r.setSearch(a),r.setPage(1),!1===wp.hooks.applyFilters("um_member_directory_ignore_after_search",!1,e)){t=parseInt(e.data("must-search"));if(1===t&&""===r.getSearch()&&0===Object.keys(r.getFilters()).length)return e.find(".um-member-directory-empty-search-result").addClass("um-display-none"),e.find(".um-member-directory-empty-no-search-result").addClass("um-display-none"),e.find(".um-member-directory-sorting .um-dropdown-wrapper .um-button").prop("disabled",!0),e.find(".um-member-view-switcher").addClass("um-disabled"),e.find(".um-member-directory-header-row-grid").addClass("um-display-none"),e.find(".um-members-wrapper").addClass("um-display-none"),e.find(".um-members-pagination-box").addClass("um-display-none"),void e.find(".um-member-directory-must-search").removeClass("um-display-none")}r.request()}}}function n(e,r,t){var a=e.find('.um-pagination-item[data-page="prev"]'),e=e.find('.um-pagination-item[data-page="next"]');(1===r?(a.addClass("disabled"),e):r===t?(e.addClass("disabled"),a):(a.removeClass("disabled"),e)).removeClass("disabled")}jQuery(document.body).on("click",".um-directory .um-member-view-switcher:not(.um-disabled) .um-button-in-group:not(.current)",function(){var e,r=jQuery(this),t=r.parents(".um-directory"),a=UM.frontend.directories.getHash(t),a=UM.frontend.directories.list[a];a.isBusy()||null!==(a=a.getLastResponse())&&(e=r.parents(".um-member-view-switcher").find(".um-button-in-group.current").data("type"),t.find(".um-members-wrapper.um-members-"+e).removeClass("um-members-"+e),r.parents(".um-member-view-switcher").find(".um-button-in-group").removeClass("current"),r.addClass("current"),e=r.data("type"),r=r.data("default"),t.find(".um-members-wrapper").addClass("um-members-"+e),r?um_set_url_from_data(t,"view_type",""):um_set_url_from_data(t,"view_type",e),t.data("view_type",e),um_build_template(t,a),um_init_new_dropdown())}),jQuery(document.body).on("click",".um-directory .um-do-search",function(){r(jQuery(this).parents(".um-directory"))}),jQuery(document.body).on("keypress",".um-directory .um-search-line",function(e){13===e.which&&r(jQuery(this).parents(".um-directory"))}),jQuery(document.body).on("click",".um-members-sorting",function(e){var r,t,a;e.preventDefault(),1===jQuery(this).data("selected")||(e=jQuery(this).data("directory-hash"),(e=UM.frontend.directories.list[e]).isBusy())||(r=e.getWrapper(),t=jQuery(this).text(),a=jQuery(this).data("value"),r.find('.um-dropdown[data-element=".um-members-sorting-toggle"]').find("a").data("selected",0).prop("data-selected",0).attr("data-selected",0),r.find('.um-dropdown[data-element=".um-members-sorting-toggle"] a[data-value="'+a+'"]').data("selected",1).prop("data-selected",1).attr("data-selected",1),r.find(".um-members-sorting-toggle .um-button-content").text(t),e.setOrder(a),e.request())}),jQuery(document.body).on("click",".um-directory .um-pagination-item:not(.current)",function(){if(!jQuery(this).hasClass("disabled")){var r=jQuery(this).parents(".um-directory"),t=UM.frontend.directories.getHash(r),t=UM.frontend.directories.list[t];if(!t.isBusy()){var a=parseInt(r.data("total_pages")),i=t.getPage(),s=jQuery(this).data("page");let e;n(r,e="prev"===s?i-1:"next"===s?i+1:parseInt(s),a),r.find(".um-pagination-item").removeClass("current"),r.find('.um-pagination-item[data-page="'+e+'"]').addClass("current"),t.setPage(e),t.request({pagination:!0})}}}),jQuery(document.body).on("change",".um-directory .um-pagination-current-page-input",function(){if(!jQuery(this).hasClass("disabled")){var r=jQuery(this).parents(".um-directory"),t=UM.frontend.directories.getHash(r),t=UM.frontend.directories.list[t];if(!t.isBusy()){var a=t.getPage();let e=parseInt(jQuery(this).val());var i=parseInt(r.data("total_pages"));a!==e&&(e<1&&(jQuery(this).val(1),e=1),e>i&&(jQuery(this).val(i),e=i),n(r,e,i),t.setPage(e),t.request({pagination:!0}))}}}),jQuery(document.body).on("keypress",".um-directory .um-pagination-current-page-input",function(e){if(13===e.which)return jQuery(this).trigger("change"),!1}),jQuery(document.body).on("change",".um-search-filter-field",function(){var e=jQuery(this).parents(".um-filters-form"),r=e.find(".um-apply-filters");UM.frontend.directories.filters.checkEmpty(e),r.prop("disabled",!1)}),jQuery(document.body).on("reset",".um-directory .um-filters-form",function(){var e=jQuery(this).parents(".um-directory"),r=UM.frontend.directories.getHash(e),r=UM.frontend.directories.list[r];if(!r.isBusy()){var t=jQuery(this),a=t.find(".um-clear-filters-a"),t=t.find(".um-apply-filters"),a=(a.addClass("um-hidden").prop("disabled",!0),t.prop("disabled",!0),r.resetFilters(),r.setPage(1),wp.hooks.applyFilters("um_member_directory_ignore_after_search",!1,e));if(!1===a){t=parseInt(e.data("must-search"));if(1===t&&""===r.getSearch()&&0===Object.keys(r.getFilters()).length)return e.find(".um-member-directory-empty-search-result").addClass("um-display-none"),e.find(".um-member-directory-empty-no-search-result").addClass("um-display-none"),e.find(".um-member-directory-sorting .um-dropdown-wrapper .um-button").prop("disabled",!0),e.find(".um-member-view-switcher").addClass("um-disabled"),e.find(".um-member-directory-header-row-grid").addClass("um-display-none"),e.find(".um-members-wrapper").addClass("um-display-none"),e.find(".um-members-pagination-box").addClass("um-display-none"),void e.find(".um-member-directory-must-search").removeClass("um-display-none")}r.request()}}),jQuery(document.body).on("click",".um-directory .um-apply-filters",function(e){e.preventDefault();var e=jQuery(this).parents(".um-directory"),r=UM.frontend.directories.getHash(e),r=UM.frontend.directories.list[r];if(!r.isBusy()){if(r.setFilters(),r.setPage(1),!1===wp.hooks.applyFilters("um_member_directory_ignore_after_search",!1,e)){var t=parseInt(e.data("must-search"));if(1===t&&""===r.getSearch()&&0===Object.keys(r.getFilters()).length)return e.find(".um-member-directory-empty-search-result").addClass("um-display-none"),e.find(".um-member-directory-empty-no-search-result").addClass("um-display-none"),e.find(".um-member-directory-sorting .um-dropdown-wrapper .um-button").prop("disabled",!0),e.find(".um-member-view-switcher").addClass("um-disabled"),e.find(".um-member-directory-header-row-grid").addClass("um-display-none"),e.find(".um-members-wrapper").addClass("um-display-none"),e.find(".um-members-pagination-box").addClass("um-display-none"),void e.find(".um-member-directory-must-search").removeClass("um-display-none")}r.request()}}),wp.hooks.doAction("um_member_directory_on_first_pages_loading"),jQuery(".um-directory").each(function(){var e=jQuery(this),r=UM.frontend.directories.getHash(e),t=new UM.frontend.directory(r),r=(UM.frontend.directories.list[r]=t,wp.hooks.doAction("um_member_directory_on_init",e,r),t.getDataFromURL("page")),r=(void 0!==r&&t.setPage(r,{ignoreURL:!0}),t.getDataFromURL("search")),r=(void 0!==r&&t.setSearch(r,{ignoreURL:!0}),t.getDataFromURL("sort")),r=(void 0!==r&&t.setOrder(r,!0),t.setFilters(!0),wp.hooks.applyFilters("um_member_directory_ignore_after_search",!1,e));if(!1===r){r=parseInt(e.data("must-search"));if(1===r&&""===t.getSearch()&&0===Object.keys(t.getFilters()).length)return}wp.hooks.applyFilters("um_member_directory_prevent_default_request",!1,t)||t.request({defaultRequest:!0})}),window.addEventListener("popstate",function(e){jQuery(".um-directory").each(function(){var e=jQuery(this),r=UM.frontend.directories.getHash(e),t=new UM.frontend.directory(r),a=(UM.frontend.directories.list[r]=t).getDataFromURL("page"),a=(void 0!==a?t.setPage(a,{ignoreURL:!0,updateUI:!0}):t.setPage("",{ignoreURL:!0,updateUI:!0}),t.getDataFromURL("search")),a=(void 0!==a?t.setSearch(a,{ignoreURL:!0,updateUI:!0}):t.setSearch("",{ignoreURL:!0,updateUI:!0}),t.getDataFromURL("sort")),a=(void 0!==a?t.setOrder(a,{ignoreURL:!0,updateUI:!0}):t.setOrder("",{ignoreURL:!0,updateUI:!0}),t.setFilters(!0),e.find(".um-member-directory-view-type").length&&(void 0===(a=um_get_data_for_directory(e,"view_type"))&&(a=e.find('.um-member-directory-view-type-a[data-default="1"]').data("type")),e.data("view_type",a),e.find(".um-member-directory-view-type .um-member-directory-view-type-a").hide(),e.find('.um-member-directory-view-type .um-member-directory-view-type-a[data-type="'+a+'"]').show()),wp.hooks.applyFilters("um_member_directory_ignore_after_search",!1,e));if(!1===a){a=parseInt(e.data("must-search"));if(1===a&&""===t.getSearch()&&0===Object.keys(t.getFilters()).length)return}wp.hooks.applyFilters("um_member_directory_prevent_default_first_loading",!1,e,r)||t.request()})})}),wp.hooks.addFilter("um_toggle_block","um_member_directory",function(e,r){var t,a;return r.hasClass("um-meta-toggle")?(e=r.parents(".um-member").find(r.data("um-toggle")),t=r.data("toggle-text"),a=r.text(),r.data("toggle-text",a).text(t)):r.hasClass("um-filters-toggle")&&(e=r.parents(".um-directory").find(r.data("um-toggle"))),e});