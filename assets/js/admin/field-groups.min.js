"undefined"==typeof um_admin_field_groups_data&&(um_admin_field_groups_data={}),"object"!=typeof window.UM&&(window.UM={}),"object"!=typeof UM.fields_groups&&(UM.fields_groups={}),UM.fields_groups={tabs:{setActive:function(e,i){var t=e.data("tab");let d=e.parents(".um-edit-field-tabs");d.find("div[data-tab]").removeClass("current"),e.addClass("current");let l=e.parents(".um-edit-field-tabs").siblings(".um-edit-field-tabs-content");l.find("div[data-tab]").removeClass("current"),l.find('div[data-tab="'+t+'"]').addClass("current")},compare:function(e,i){if(e.length!==i.length)return!1;for(var t=0;t<e.length;t++)if(e[t]!==i[t])return!1;return!0},compareDeep:function(e,d){if(typeof e!=typeof d)return!1;if("object"!=typeof e)return e===d;{if(!UM.fields_groups.tabs.compare(Object.keys(e),Object.keys(d)))return!1;let t=!0;return Object.entries(e).forEach(([e,i])=>{if(t=UM.fields_groups.tabs.compareDeep(i,d[e]),!t)return!1}),t}},reBuild:function(e,i,t){var d=e.find(".um-edit-field-tabs > div[data-tab].current").data("tab");e.find(".um-edit-field-tabs > div[data-tab]").remove(),e.find(".um-edit-field-tabs-content > div[data-tab]").each(function(){i.includes(t(this).data("tab"))||t(this).remove()});let l="";for(var n=0;n<i.length;n++)l+='<div data-tab="'+i[n]+'">'+um_admin_field_groups_data.field_tabs[i[n]]+"</div>",e.find('.um-edit-field-tabs-content > div[data-tab="'+i[n]+'"]').length||e.find(".um-edit-field-tabs-content").append('<div data-tab="'+i[n]+'"></div>');e.find(".um-edit-field-tabs").html(l),e.find('.um-edit-field-tabs > div[data-tab="'+d+'"]').addClass("current"),e.find('.um-edit-field-tabs-content > div[data-tab="'+d+'"]').addClass("current")}},sortable:{init:function(t){t(".um-field-groups-fields-wrapper").sortable({items:".um-field-groups-field-row",connectWith:"um-field-groups-fields-wrapper",placeholder:"um-field-groups-field-placeholder",forcePlaceholderSize:!0,axis:"y",cursor:"move",handle:".um-field-groups-field-move-link",update:function(e,i){t(".um-field-groups-field-row").each(function(e){e=+e+1;t(this).find(".um-field-groups-field-order").val(e),t(this).find(".um-field-groups-field-row-header .um-field-groups-field-move-link").html(e)})}}).on("sortupdate",function(){t(".um-field-groups-field-row").each(function(e){e=+e+1;t(this).find(".um-field-groups-field-order").val(e),t(this).find(".um-field-groups-field-row-header .um-field-groups-field-move-link").html(e)})})},destroy:function(e){e(".um-field-groups-fields-wrapper").sortable("destroy")},reInit:function(e){UM.fields_groups.sortable.destroy(e),UM.fields_groups.sortable.init(e),e(".um-field-groups-fields-wrapper").trigger("sortupdate")}},field:{newIndex:0,settingsScreens:{},prepareSettings:function(d,e,l){d(".um-field-groups-fields-wrapper").find(".um-field-groups-field-row").each(function(){let i=d(this).data("field"),t=d(this).find(".um-field-groups-field-type-select").val();void 0!==e&&e!=i||("object"!=typeof UM.fields_groups.field.settingsScreens[i]&&(UM.fields_groups.field.settingsScreens[i]={}),"object"!=typeof UM.fields_groups.field.settingsScreens[i][t]&&(UM.fields_groups.field.settingsScreens[i][t]={}),d(this).find(".um-edit-field-tabs > div[data-tab]").each(function(){var e=d(this).data("tab");void 0!==l&&l!=e||(UM.fields_groups.field.settingsScreens[i][t][e]=d(this).parents(".um-edit-field-tabs").siblings(".um-edit-field-tabs-content").find('div[data-tab="'+e+'"] > .form-table')[0].outerHTML)}))})},add:function(f){let e=f(".um-field-groups-fields-wrapper"),i=f(".um-field-groups-field-row-template").clone().addClass("um-field-groups-field-row").removeClass("um-field-groups-field-row-template");UM.fields_groups.field.newIndex++;let c=UM.fields_groups.field.newIndex;i.data("field","new_"+c).attr("data-field","new_"+c);var t,d=e.find(".um-field-groups-field-row").length+1;i.find(".um-field-groups-field-move-link").html(d);let l=i.find(".um-field-groups-field-id");l.removeAttr("disabled").prop("disabled",!1);let n=l.attr("name");void 0!==n&&(t=n.replace("{index}",c),l.attr("name",t));let o=i.find(".um-field-groups-field-order");o.val(d).removeAttr("disabled").prop("disabled",!1);let s=o.attr("name");void 0!==s&&(d=s.replace("{index}",c),o.attr("name",d)),i.find(".um-form-table").each(function(e){let i=f(this).data("extra-class");void 0!==i&&(i=i.replace("{index}",c),i&&f(this).removeAttr("class").addClass("form-table um-form-table "+i))}),i.find(".um-forms-line").each(function(e){let i=f(this).data("prefix");var t,d,l;void 0!==i&&(t=i.replace("new_index","new_"+c),f(this).data("prefix",t).attr("data-prefix",t));let n=f(this).find("label"),o=n.attr("for");void 0!==o&&(t=o.replace("new_index","new_"+c),n.attr("for",t));let s=f(this).find(".um-forms-field"),a=s.attr("id");void 0!==a&&(d=a.replace("new_index","new_"+c),s.attr("id",d));let r=s.attr("name");void 0!==r&&(d=r.replace("{index}",c),s.attr("name",d)),s.removeAttr("disabled").prop("disabled",!1);let u=s.siblings('input[type="hidden"]');if(u.length){let e=u.attr("id");void 0!==e&&(l=e.replace("new_index","new_"+c),u.attr("id",l));let i=u.attr("name");void 0!==i&&(l=i.replace("{index}",c),u.attr("name",l)),u.removeAttr("disabled").prop("disabled",!1)}});let a=i.data("field");i.find(".um-conditional-rule-field-col .um-conditional-rule-setting").each(function(){f(this).find("option").each(function(){f(this).is(":selected")||""===f(this).attr("value")||f(this).remove()});let t=f(this);var e=t.val();f.each(UM.fields_groups.field.conditional.fieldsList,function(e,i){t.find('option[value="'+e+'"]').length||a==e||t.find('option[value=""]').after('<option value="'+e+'">'+i.title+"</option>")});let i=t.find("option").detach();i.sort(function(e,i){return""===f(e).val()?0:f(e).text()>f(i).text()?1:f(e).text()<f(i).text()?-1:0}),t.append(i).val(e)}),e.append(i),1<e.find(".um-field-groups-field-row").length?UM.fields_groups.sortable.reInit(f):(e.removeClass("hidden"),e.siblings(".um-field-groups-builder-header").removeClass("hidden"),e.siblings(".um-field-groups-fields-wrapper-empty").addClass("hidden"),UM.fields_groups.sortable.init(f)),UM.fields_groups.field.conditional.prepareFieldsList(f)},toggleEdit:function(e,i){e.hasClass("um-field-row-edit-mode")?UM.fields_groups.field.hideEdit(e,i):UM.fields_groups.field.showEdit(e,i)},showEdit:function(e,i){e.addClass("um-field-row-edit-mode")},hideEdit:function(e,i){e.removeClass("um-field-row-edit-mode")},duplicate:function(e,i){var t=e.parents(".um-field-groups-field-row").clone();e.parents(".um-field-groups-field-row").after(t),UM.fields_groups.sortable.reInit(i),UM.fields_groups.field.conditional.prepareFieldsList(i)},delete:function(e,i){let t=e.parents(".um-field-groups-fields-wrapper");e.parents(".um-field-groups-field-row").remove(),t.find(".um-field-groups-field-row").length?UM.fields_groups.sortable.reInit(i):(t.addClass("hidden"),t.siblings(".um-field-groups-builder-header").addClass("hidden"),t.siblings(".um-field-groups-fields-wrapper-empty").removeClass("hidden"),UM.fields_groups.sortable.destroy(i)),UM.fields_groups.field.conditional.prepareFieldsList(i)},conditional:{fieldsList:{},prepareFieldsList:function(e){e(".um-field-groups-fields-wrapper").find(".um-field-groups-field-row").each(function(){var t=e(this).data("field"),d=e(this).find(".um-field-groups-field-type-select").val(),l=e(this).find(".um-field-groups-field-title-input").val();if(um_admin_field_groups_data.field_types[d].conditional_rules.length){let i={};um_admin_field_groups_data.field_types[d].conditional_rules.forEach(e=>{i[e]=um_admin_field_groups_data.conditional_rules[e]});let e=null;"choice"===um_admin_field_groups_data.field_types[d].category&&(e={}),UM.fields_groups.field.conditional.fieldsList[t]={type:d,title:l,conditions:i,valueOptions:e}}})},reset:function(e,i){let t=e.parents('.um-edit-field-tabs-content > div[data-tab="conditional"]');t.find(".um-conditional-rules-wrapper .um-conditional-remove-rule").each(function(e){i(this).trigger("click")})},addRulesGroup:function(e,d){let i=e.siblings(".um-conditional-rules-group-template").clone().addClass("um-conditional-rules-group").removeClass("um-conditional-rules-group-template"),l=e.find(".um-conditional-rules-group").length;i.data("group-index",l).attr("data-group-index",l),i.find(".um-conditional-rule-setting").each(function(e){let i=d(this).attr("name");var t;void 0!==i&&(t=i.replace("{group_key}",l),d(this).attr("name",t),d(this).parents(".um-conditional-rule-field-col").length&&d(this).prop("disabled",!1).removeAttr("disabled"))}),e.find(".um-conditional-rules-wrapper-bottom").before(i),UM.fields_groups.field.conditional.showReset(e,d),UM.fields_groups.field.prepareSettings(d)},addRule:function(e,t){let i=e.parents(".um-conditional-rules-wrapper"),d=i.siblings(".um-conditional-rule-row-template").clone().addClass("um-conditional-rule-row").removeClass("um-conditional-rule-row-template"),l=e.parents(".um-conditional-rules-group").data("group-index"),n=e.parents(".um-conditional-rules-group").find(".um-conditional-rule-row").length;d.find(".um-conditional-rule-setting").each(function(e){let i=t(this).attr("name");if(void 0!==i){let e=i.replace("{group_key}",l);e=e.replace("{row_key}",n),t(this).attr("name",e),t(this).parents(".um-conditional-rule-field-col").length&&t(this).prop("disabled",!1).removeAttr("disabled")}}),e.after(d),UM.fields_groups.field.conditional.changeInputIndex(i,t),UM.fields_groups.field.conditional.showReset(i,t),UM.fields_groups.field.prepareSettings(t)},removeRule:function(e,i){let t=e.parents(".um-conditional-rules-wrapper"),d=t.find(".um-conditional-rule-row");if(1===d.length)return d.find(".um-conditional-rule-field-col select").val(""),d.find(".um-conditional-rule-condition-col select").val(""),d.find(".um-conditional-rule-value-col select,.um-conditional-rule-value-col input").val(""),void UM.fields_groups.field.conditional.hideReset(t,i);let l=e.parents(".um-conditional-rules-group");(1===l.find(".um-conditional-rule-row").length?l:e).remove(),UM.fields_groups.field.conditional.changeInputIndex(t,i),UM.fields_groups.field.prepareSettings(i)},changeInputIndex:function(e,d){let l=0;e.find(".um-conditional-rules-group").each(function(e){let t=0;d(this).find(".um-conditional-rule-row").each(function(e){d(this).find(".um-conditional-rule-setting").each(function(e){let i=d(this).data("base-name");if(void 0!==i){let e=i.replace("{group_key}",l);e=e.replace("{row_key}",t),d(this).attr("name",e)}}),t++}),d(this).data("group-index",l).attr("data-group-index",l),l++})},showReset:function(e,i){let t=e.parents('.um-edit-field-tabs-content > div[data-tab="conditional"]');t.find(".um-field-groups-field-reset-all-conditions").css({visibility:"visible"})},hideReset:function(e,i){let t=e.parents('.um-edit-field-tabs-content > div[data-tab="conditional"]');t.find(".um-field-groups-field-reset-all-conditions").css({visibility:"hidden"})},parseRules:function(e,i){let t=[];return e.find(".um-conditional-rule-field-col select,.um-conditional-rule-condition-col select,.um-conditional-rule-value-col select,.um-conditional-rule-value-col input").each(function(e){""!==i(this).val()&&t.push(i(this))}),t},isEmpty:function(e,i){return!UM.fields_groups.field.conditional.parseRules(e,i).length}},changeType:function(l,n){let o=l.data("field");var e=UM.fields_groups.field.conditional.fieldsList[o].type,i=um_admin_field_groups_data.field_types[e].settings;let s=l.find(".um-field-groups-field-type-select").val();var t=um_admin_field_groups_data.field_types[s].settings,d=Object.keys(i),a=Object.keys(t),e=l.find('.um-field-groups-field-type-select option[value="'+l.find(".um-field-groups-field-type-select").val()+'"]').html();if(l.find(".um-field-groups-field-type").html(e),UM.fields_groups.tabs.compare(d,a)||UM.fields_groups.tabs.reBuild(l,a,n),l.find(".um-edit-field-tabs > div[data-tab]").addClass("disabled"),"object"==typeof UM.fields_groups.field.settingsScreens[o]&&"object"==typeof UM.fields_groups.field.settingsScreens[o][s])n.each(UM.fields_groups.field.settingsScreens[o][s],function(e,i){let t=l.find('.um-edit-field-tabs-content > div[data-tab="'+e+'"]'),d=n("<div>").append(i).find(".form-table");"conditional"===e&&d.find('[data-field_type="conditional_rules"]').html(t.find('[data-field_type="conditional_rules"]').html()),t.find(".um-field-groups-static-field").each(function(){d.find('[name="'+n(this).attr("name")+'"]').val(n(this).val())}),l.find('.um-edit-field-tabs-content > div[data-tab="'+e+'"]').html(d[0].outerHTML)}),l.find(".um-field-groups-field-type-select").removeClass("disabled").prop("disabled",!1),run_check_conditions(),UM.fields_groups.field.conditional.prepareFieldsList(n),l.find(".um-edit-field-tabs > div[data-tab]").removeClass("disabled");else{if(!UM.fields_groups.tabs.compareDeep(i.general,t.general)){l.find('.um-edit-field-tabs-content > div[data-tab="general"] .um-forms-field:not(.um-field-groups-static-field)').parents(".um-forms-line").remove();var r=Object.keys(t.general).length-2;if(0<r){let e=0;for(;e<r;)l.find('.um-edit-field-tabs-content > div[data-tab="general"] > .form-table tbody').append('<tr class="um-forms-line um-forms-skeleton"><th><span class="um-skeleton-box" style="width:100%;height:20px;"></span></th><td><span class="um-skeleton-box" style="width:100%;height:40px;margin-bottom:4px;"></span><span class="um-skeleton-box" style="width:100%;height:20px;"></span></td></tr>'),e++}}wp.ajax.send("um_fields_groups_get_settings_form",{data:{field_id:o,type:s,nonce:um_admin_scripts.nonce},success:function(e){"object"!=typeof UM.fields_groups.field.settingsScreens[o]&&(UM.fields_groups.field.settingsScreens[o]={}),"object"!=typeof UM.fields_groups.field.settingsScreens[o][s]&&(UM.fields_groups.field.settingsScreens[o][s]={}),n.each(e.fields,function(e,i){UM.fields_groups.field.settingsScreens[o][s][e]=i;let t=n("<div>").append(i).find(".form-table"),d=l.find('.um-edit-field-tabs-content > div[data-tab="'+e+'"]');"conditional"===e&&t.find('[data-field_type="conditional_rules"]').html(d.find('[data-field_type="conditional_rules"]').html()),d.find(".um-field-groups-static-field").each(function(){t.find('[name="'+n(this).attr("name")+'"]').val(n(this).val())}),d.html(t[0].outerHTML)}),l.find(".um-field-groups-field-type-select").removeClass("disabled").prop("disabled",!1),run_check_conditions(),UM.fields_groups.field.conditional.prepareFieldsList(n),l.find(".um-edit-field-tabs > div[data-tab]").removeClass("disabled")},error:function(e){console.error(e)}})}}}},jQuery(function(l){UM.fields_groups.field.conditional.prepareFieldsList(l),l(".um-field-groups-fields-wrapper").find(".um-field-groups-field-row").each(function(){let d=l(this).data("field");l(this).find(".um-conditional-rule-field-col .um-conditional-rule-setting").each(function(){l(this).find("option").each(function(){l(this).is(":selected")||""===l(this).attr("value")||l(this).remove()});let t=l(this);var e=t.val();l.each(UM.fields_groups.field.conditional.fieldsList,function(e,i){t.find('option[value="'+e+'"]').length||d==e||t.find('option[value=""]').after('<option value="'+e+'">'+i.title+"</option>")});let i=t.find("option").detach();i.sort(function(e,i){return""===l(e).val()?0:l(e).text()>l(i).text()?1:l(e).text()<l(i).text()?-1:0}),t.append(i).val(e)})}),UM.fields_groups.field.prepareSettings(l),console.log(UM.fields_groups.field.settingsScreens),UM.fields_groups.sortable.init(l),l(document.body).on("click",".um-field-groups-field-row",function(e){void 0!==e.target&&e.target.classList.contains("um-field-groups-toggle-edit")&&(e.preventDefault(),UM.fields_groups.field.toggleEdit(l(this),l))}),l(document.body).on("click",".um-field-groups-field-edit",function(e){e.preventDefault();e=l(this).parents(".um-field-groups-field-row");UM.fields_groups.field.toggleEdit(e,l)}),l(document.body).on("click",".um-field-groups-field-delete",function(e){e.preventDefault(),confirm(wp.i18n.__("Are you sure you want to delete this field?","ultimate-member"))&&UM.fields_groups.field.delete(l(this),l)}),l(document.body).on("click",".um-field-groups-field-duplicate",function(e){e.preventDefault(),confirm(wp.i18n.__("Are you sure you want to duplicate this field?","ultimate-member"))&&UM.fields_groups.field.duplicate(l(this),l)}),l(document.body).on("click",".um-add-field-groups-field",function(e){e.preventDefault(),UM.fields_groups.field.add(l)}),l(document.body).on("click",".um-edit-field-tabs > div[data-tab]:not(.current)",function(e){e.preventDefault(),l(this).hasClass("disabled")||UM.fields_groups.tabs.setActive(l(this),l)}),l(document.body).on("click",".um-field-groups-field-reset-all-conditions",function(e){e.preventDefault(),confirm(wp.i18n.__("Are you sure?","ultimate-member"))&&UM.fields_groups.field.conditional.reset(l(this),l)}),l(document.body).on("click",".um-conditional-add-rules-group",function(e){e.preventDefault();e=l(this).parents(".um-conditional-rules-wrapper");UM.fields_groups.field.conditional.addRulesGroup(e,l)}),l(document.body).on("click",".um-conditional-add-rule",function(e){e.preventDefault();e=l(this).parents(".um-conditional-rule-row");UM.fields_groups.field.conditional.addRule(e,l)}),l(document.body).on("click",".um-conditional-remove-rule",function(e){e.preventDefault();e=l(this).parents(".um-conditional-rule-row");UM.fields_groups.field.conditional.removeRule(e,l)}),l(document.body).on("change",".um-conditional-rule-field-col select, .um-conditional-rule-condition-col select, .um-conditional-rule-value-col select,.um-conditional-rule-value-col input",function(e){var i=l(this).parents('.um-edit-field-tabs-content > div[data-tab="conditional"]');UM.fields_groups.field.conditional.isEmpty(i,l)?UM.fields_groups.field.conditional.hideReset(l(this),l):UM.fields_groups.field.conditional.showReset(l(this),l)}),l(document.body).on("change",".um-conditional-rule-field-col .um-conditional-rule-setting",function(e){var i=l(this).val();let d=l(this).parents(".um-conditional-rule-fields");if(""===i)d.find(".um-conditional-rule-condition-col .um-conditional-rule-setting").prop("disabled",!0),d.find(".um-conditional-rule-value-col input.um-conditional-rule-setting").prop("disabled",!0).show(),d.find(".um-conditional-rule-value-col select.um-conditional-rule-setting").prop("disabled",!0).hide();else{let t=d.find(".um-conditional-rule-condition-col .um-conditional-rule-setting");t.prop("disabled",!1),t.find("option").each(function(){""!==l(this).attr("value")&&l(this).remove()});t.val();l.each(UM.fields_groups.field.conditional.fieldsList[i].conditions,function(e,i){t.find('option[value="'+e+'"]').length||t.find('option[value=""]').after('<option value="'+e+'">'+i+"</option>")});let e=t.find("option").detach();e.sort(function(e,i){return""===l(e).val()?0:l(e).text()>l(i).text()?1:l(e).text()<l(i).text()?-1:0}),t.append(e).val(""),null===UM.fields_groups.field.conditional.fieldsList[i].valueOptions?(d.find(".um-conditional-rule-value-col input.um-conditional-rule-setting").prop("disabled",!0).show(),d.find(".um-conditional-rule-value-col select.um-conditional-rule-setting").prop("disabled",!0).hide()):(d.find(".um-conditional-rule-value-col input.um-conditional-rule-setting").prop("disabled",!0).hide(),d.find(".um-conditional-rule-value-col select.um-conditional-rule-setting").prop("disabled",!0).show())}}),l(document.body).on("change",".um-conditional-rule-condition-col .um-conditional-rule-setting",function(e){var i=l(this).val();let t=l(this).parents(".um-conditional-rule-fields");var d=t.find(".um-conditional-rule-field-col .um-conditional-rule-setting").val();""===i||"!=empty"===i||"==empty"===i?(t.find(".um-conditional-rule-value-col input.um-conditional-rule-setting").prop("disabled",!0).show(),t.find(".um-conditional-rule-value-col select.um-conditional-rule-setting").prop("disabled",!0).hide()):null===UM.fields_groups.field.conditional.fieldsList[d].valueOptions?(t.find(".um-conditional-rule-value-col input.um-conditional-rule-setting").prop("disabled",!1).show(),t.find(".um-conditional-rule-value-col select.um-conditional-rule-setting").prop("disabled",!0).hide()):(t.find(".um-conditional-rule-value-col input.um-conditional-rule-setting").prop("disabled",!0).hide(),t.find(".um-conditional-rule-value-col select.um-conditional-rule-setting").prop("disabled",!1).show())}),l(".um-conditional-rules-wrapper .um-conditional-rule-condition-col .um-conditional-rule-setting").trigger("change"),l(document.body).on("change",".um-field-groups-field-title-input",function(e){l(this).parents(".um-field-groups-field-row").find(".um-field-groups-field-title").html(l(this).val()),UM.fields_groups.field.conditional.prepareFieldsList(l)}),l(document.body).on("change",".um-forms-field:not(.um-field-groups-field-type-select)",function(e){let i=l(this).parents(".um-field-groups-field-row");var t=i.data("field"),d=l(this).parents("div[data-tab]").data("tab");UM.fields_groups.field.prepareSettings(l,t,d)}),l(document.body).on("change",".um-field-groups-field-type-select",function(e){var i;l(this).hasClass("disabled")||(l(this).addClass("disabled").prop("disabled",!0),i=l(this).parents(".um-field-groups-field-row"),UM.fields_groups.field.changeType(i,l))}),l(document.body).on("change",".um-field-groups-field-metakey-input",function(e){let i=wp.i18n.__("(no metakey)","ultimate-member");""!==l(this).val()&&(i=l(this).val()),l(this).parents(".um-field-groups-field-row").find(".um-field-groups-field-metakey").html(i)})});