function um_admin_init_users_select(){function e(e){var a;return e.id?void 0!==e.img?jQuery('<span><img style="vertical-align: sub; width: 20px; height: 20px;" src="'+e.img+'" /> '+e.text+"</span>"):(a=e.element.attributes["data-img"].value)?jQuery('<img style="vertical-align: sub; width: 20px; height: 20px;" src="'+a+'" /> '+e.text+"</span>"):jQuery("<span>"+e.text+"</span>"):e.text}var a;jQuery(".um-user-select-field").length&&(a={ajax:{url:wp.ajax.settings.url,dataType:"json",delay:250,data:function(e){var a={action:"um_get_users",search:e.term,page:e.page||1,nonce:um_admin_scripts.nonce};return jQuery.each(jQuery(this)[0].attributes,function(){var e;this.specified&&-1!==this.name.indexOf("data-ajax-args-")&&(e=this.name.replace("data-ajax-args-","").trim(),a[e]=this.value)}),a},processResults:function(e,a){a.page=a.page||1;var i=[];return e.data.users&&jQuery.each(e.data.users,function(e,a){void 0!==a.img?i.push({id:a.ID,text:a.user_login+" (#"+a.ID+")",img:a.img}):i.push({id:a.ID,text:a.user_login+" (#"+a.ID+")"})}),{results:i,pagination:{more:20*a.page<e.data.total_count}}},cache:!0},minimumInputLength:0,allowClear:!0,width:"100%",allowHtml:!0,dropdownCssClass:"um-select2-users-dropdown",containerCssClass:"um-select2-users-container",placeholder:jQuery(this).data("placeholder"),templateSelection:e,templateResult:e},jQuery(".um-user-select-field").select2(a))}function um_add_same_page_log(e,a){var e=jQuery(".um-same-page-update-"+e).find(".upgrade_log"),i=e.html();e.html(i+a+"<br />")}function um_same_page_wrong_ajax(e){um_add_same_page_log(e,wp.i18n.__("Wrong AJAX response...","ultimate-member")),um_add_same_page_log(e,wp.i18n.__("Your upgrade was crashed, please contact with support","ultimate-member"))}function um_same_page_something_wrong(e){um_add_same_page_log(e,wp.i18n.__("Something went wrong with AJAX request...","ultimate-member")),um_add_same_page_log(e,wp.i18n.__("Your upgrade was crashed, please contact with support","ultimate-member"))}function run_check_conditions(){jQuery(".um-forms-line").removeClass("um-forms-line-conditioned").each(function(){void 0===jQuery(this).data("conditional")||jQuery(this).hasClass("um-forms-line-conditioned")||(check_condition(jQuery(this))?(jQuery(this).find("input:not(.um-force-disabled), textarea:not(.um-force-disabled), select:not(.um-force-disabled)").removeAttr("disabled").prop("disabled",!1),jQuery(this).show()):(jQuery(this).find("input, textarea, select").attr("disabled","disabled").prop("disabled",!0),jQuery(this).hide()))})}function check_condition(e){e.addClass("um-forms-line-conditioned");var i,a,t,s,l,n,d,u,r,m,o=e.data("conditional"),c=o[1],p=o[2],f=e.data("prefix"),_=!0,g=("="===c||"!="===c?-1===o[0].indexOf("||")&&void 0!==(a=jQuery("#"+f+"_"+o[0])).parents(".um-forms-line").data("conditional")&&(_=check_condition(a.parents(".um-forms-line"))):"~"===c?(t=o[0].split("|"),i=[],jQuery.each(t,function(e){i.push(jQuery("#"+f+"_"+t[e]))}),void 0!==i[0].parents(".um-forms-line").data("conditional")&&(_=check_condition(i[0].parents(".um-forms-line")))):"><"===c&&void 0!==(a=jQuery("#"+f+"_"+o[0]+"_"+o[2])).parents(".um-forms-line").data("conditional")&&(_=check_condition(a.parents(".um-forms-line"))),!1);return"="===c?-1!==o[0].indexOf("||")?(t=o[0].split("||"),s=!1,jQuery.each(t,function(e){var a,e=jQuery("#"+f+"_"+t[e]),i=(_=!(g=!1),void 0!==e.parents(".um-forms-line").data("conditional")&&(_=check_condition(e.parents(".um-forms-line"))),e.prop("tagName").toLowerCase());"input"===i?(a=e.attr("type"),g="checkbox"===a?"1"==p?e.is(":checked"):!e.is(":checked"):Array.isArray(p)?-1!==p.indexOf(e.val()):e.val()==p):"select"===i&&(g=Array.isArray(p)?-1!==p.indexOf(e.val()):e.val()==p),g&&_&&(s=!0)}),s):("input"==(r=a.prop("tagName").toLowerCase())?g="checkbox"==(m=a.attr("type"))?"1"==p?a.is(":checked"):!a.is(":checked"):Array.isArray(p)?-1!==p.indexOf(a.val()):a.val()==p:"select"==r&&(g=Array.isArray(p)?-1!==p.indexOf(a.val()):a.val()==p),g&&_):"!="===c?-1!==o[0].indexOf("||")?(t=o[0].split("||"),s=!1,jQuery.each(t,function(e){var a,e=jQuery("#"+f+"_"+t[e]),i=(_=!(g=!1),void 0!==e.parents(".um-forms-line").data("conditional")&&(_=check_condition(e.parents(".um-forms-line"))),e.prop("tagName").toLowerCase());"input"===i?(a=e.attr("type"),g="checkbox"===a?"1"==p?!e.is(":checked"):e.is(":checked"):e.val()!=p):"select"===i&&(g=e.val()!=p),g&&_&&(s=!0)}),s):("input"==(r=a.prop("tagName").toLowerCase())?(m=a.attr("type"),g="checkbox"==m?"1"==p?!a.is(":checked"):a.is(":checked"):a.val()!=p):"select"==r&&(g=a.val()!=p),g&&_):"~"===c?(l=[],"sortable_items"===e.data("field_type")?(u=e.find(".um-sortable-items-value").data("field_id"),jQuery.each(i,function(e){var e=i[e],a=e.prop("tagName").toLowerCase();"input"===a?"checkbox"===e.attr("type")&&"1"==p&&e.is(":checked")&&l.push(e.data("fill_"+u)):"select"==a&&!p&&e.val()&&(l=(l=l.concat(e.val())).filter(um_distinct))}),n=jQuery('[data-field_id="'+u+'"]'),l.length?(n.siblings(".um-sortable-items-field").find("li").addClass("um-hidden-item"),jQuery.each(l,function(e){n.siblings(".um-sortable-items-field").find('li[data-tab-id="'+l[e]+'"]').removeClass("um-hidden-item")}),d=[],n.siblings(".um-sortable-items-field").find("li").each(function(){jQuery(this).hasClass("um-hidden-item")||d.push(jQuery(this).data("tab-id"))}),n.val(d.join(",")),n.siblings(".um-sortable-items-field").sortable("refresh"),g=!0):n.val(null)):(u=e.find(e.data("field_type")).data("field_id"),jQuery.each(i,function(e){var e=i[e],a=e.prop("tagName").toLowerCase();"input"===a?"checkbox"===e.attr("type")&&"1"==p&&e.is(":checked")&&l.push(e.data("fill_"+u)):"select"==a&&!p&&e.val()&&(l=(l=l.concat(e.val())).filter(um_distinct))}),n=jQuery('[data-field_id="'+u+'"]'),l.length?(n.find("option").hide(),jQuery.each(l,function(e){n.find('option[value="'+l[e]+'"]').show()}),-1===l.indexOf(n.val())&&(n.val(l[0]),n.find("option").attr("selected",!1).prop("selected",!1),n.find('option[value="'+l[0]+'"]').attr("selected",!0).prop("selected",!0)),g=!0):(n.val(null),n.find("option").attr("selected",!1).prop("selected",!1))),g&&_):"><"===c&&(r=a.prop("tagName").toLowerCase(),g="input"==r&&"checkbox"==(m=a.attr("type"))?a.is(":checked"):g)&&_}jQuery(document).ready(function(){um_admin_init_users_select(),um_init_helptips(),jQuery(".um-pages-select2").select2({ajax:{url:wp.ajax.settings.url,dataType:"json",delay:250,data:function(e){return{search:e.term,action:"um_get_pages_list",page:e.page||1,nonce:um_admin_scripts.nonce}},processResults:function(e,a){a.page=a.page||1;var i=[];return e&&jQuery.each(e,function(e,a){"total_count"!==e&&i.push({id:a[0],text:a[1]})}),{results:i,pagination:{more:10*a.page<e.total_count}}},cache:!0},placeholder:jQuery(this).data("placeholder"),minimumInputLength:0,allowClear:!0}),jQuery(document.body).on("click",".um-forms-field[data-log-object]",function(){var e=jQuery(this).data("log-object");jQuery(this).is(":checked")?jQuery(this).siblings(".um-same-page-update-"+e).show():jQuery(this).siblings(".um-same-page-update-"+e).hide()}),jQuery(document.body).on("click",".um-admin-form-same-page-update",function(){var i,a,t,s=jQuery(this).data("upgrade_cb");jQuery(this).prop("disabled",!0),um_add_same_page_log(s,wp.i18n.__("Upgrade Process Started...","ultimate-member")),"sync_metatable"===s?(i=0,a=500,jQuery.ajax({url:wp.ajax.settings.url,type:"POST",dataType:"json",data:{action:"um_same_page_update",cb_func:"um_usermeta_fields",nonce:um_admin_scripts.nonce},success:function(e){t=1,um_add_same_page_log(s,wp.i18n.__("Getting metadata","ultimate-member")),jQuery.ajax({url:wp.ajax.settings.url,type:"POST",dataType:"json",data:{action:"um_same_page_update",cb_func:"um_get_metadata",nonce:um_admin_scripts.nonce},success:function(e){void 0!==e.data.count?(um_add_same_page_log(s,wp.i18n.__("There are ","ultimate-member")+e.data.count+wp.i18n.__(" metadata rows...","ultimate-member")),um_add_same_page_log(s,wp.i18n.__("Start metadata upgrading...","ultimate-member")),i=Math.ceil(e.data.count/a),function a(){t<=i?jQuery.ajax({url:wp.ajax.settings.url,type:"POST",dataType:"json",data:{action:"um_same_page_update",cb_func:"um_update_metadata_per_page",page:t,nonce:um_admin_scripts.nonce},success:function(e){void 0!==e.data?(um_add_same_page_log(s,e.data.message),t++,a()):um_same_page_wrong_ajax(s)},error:function(){um_same_page_something_wrong(s)}}):window.location=um_forms_data.successfully_redirect}()):um_same_page_wrong_ajax(s)},error:function(){um_same_page_something_wrong(s)}})},error:function(){um_same_page_something_wrong(s)}})):wp.hooks.doAction("um_same_page_upgrade",s)}),jQuery(".um-sortable-items-field").sortable({items:".um-sortable-item",connectWith:".um-admin-drag-col,.um-admin-drag-group",forcePlaceholderSize:!0,update:function(e,a){var i=[];jQuery(this).find("li").each(function(){jQuery(this).hasClass("um-hidden-item")||i.push(jQuery(this).data("tab-id"))}),jQuery(this).siblings(".um-sortable-items-value").val(i.join(","))}}),jQuery(".um-multi-selects-list.um-sortable-multi-selects").sortable({items:".um-admin-drag-fld",connectWith:".um-admin-drag-col,.um-admin-drag-group",forcePlaceholderSize:!0}),jQuery('.um-multi-selects-list[data-field_id="_um_sorting_fields"] li').each(function(){"other"===jQuery(this).find(".um-field-wrapper:not(.um-custom-order-fields) select").val()?jQuery(this).find(".um-field-wrapper.um-custom-order-fields").show():jQuery(this).find(".um-field-wrapper.um-custom-order-fields").hide()}),jQuery('.um-forms-line[data-field_type="md_sorting_fields"] .um-multi-selects-add-option').on("click",function(){var e=jQuery(this).siblings("ul.um-multi-selects-list"),a=e.hasClass("um-sortable-multi-selects"),i=(e.data("field_id"),0);0<e.find("li:last select.um-forms-field").length&&(i=+(i=e.find("li:last select.um-forms-field").attr("id").split("-"))[1]+1);var t='<li class="um-multi-selects-option-line'+(a?" um-admin-drag-fld":"")+'">';a&&(t+='<span class="um-field-icon"><i class="fas fa-sort"></i></span>'),t+='<span class="um-field-wrapper">'+jQuery("<div>").append(e.siblings(".um-hidden-multi-selects").clone()).html()+'</span><span class="um-field-control"><a href="javascript:void(0);" class="um-select-delete">'+wp.i18n.__("Remove","ultimate-member")+'</a></span><span class="um-field-wrapper um-custom-order-fields"><label>'+wp.i18n.__("Meta key","ultimate-member")+':&nbsp;<input type="text" name="meta_key" /></label></span><span class="um-field-wrapper um-custom-order-fields"><label>'+wp.i18n.__("Label","ultimate-member")+':&nbsp;<input type="text" name="label" /></label></span></li>',e.append(t),e.find("li:last .um-hidden-multi-selects").attr("name",jQuery(this).data("name")).addClass("um-forms-field um-long-field").removeClass("um-hidden-multi-selects").attr("id",e.data("id_attr")+"-"+i).trigger("change"),jQuery("#"+e.data("id_attr")+"-"+i).parents("li").find('.um-field-wrapper.um-custom-order-fields input[name="meta_key"]').attr("name","um_metadata[_um_sorting_fields][other_data]["+i+"][meta_key]"),jQuery("#"+e.data("id_attr")+"-"+i).parents("li").find('.um-field-wrapper.um-custom-order-fields input[name="label"]').attr("name","um_metadata[_um_sorting_fields][other_data]["+i+"][label]")}),jQuery(document.body).on("change",'.um-multi-selects-list[data-field_id="_um_sorting_fields"] .um-field-wrapper:not(.um-custom-order-fields) select',function(){"other"===jQuery(this).val()?jQuery(this).parents("li").find(".um-field-wrapper.um-custom-order-fields").show():jQuery(this).parents("li").find(".um-field-wrapper.um-custom-order-fields").hide()}),jQuery(document.body).on("click",".um-multi-selects-option-line .um-select-delete",function(){jQuery(this).parents("li.um-multi-selects-option-line").remove()}),jQuery(document.body).on("click",".um-md-default-filters-option-line .um-select-delete",function(){jQuery(this).parents("li.um-md-default-filters-option-line").remove()}),jQuery(".um-multi-selects-add-option").on("click",function(){var e,a,i,t;jQuery(this).parents('.um-forms-line[data-field_type="md_sorting_fields"]').length||(a=(e=jQuery(this).siblings("ul.um-multi-selects-list")).hasClass("um-sortable-multi-selects"),e.data("field_id"),(i=0)<e.find("li:last select.um-forms-field").length&&(i=+(i=e.find("li:last select.um-forms-field").attr("id").split("-"))[1]+1),t='<li class="um-multi-selects-option-line'+(a?" um-admin-drag-fld":"")+'">',a&&(t+='<span class="um-field-icon"><i class="fas fa-sort"></i></span>'),t+='<span class="um-field-wrapper">'+jQuery("<div>").append(e.siblings(".um-hidden-multi-selects").clone()).html()+'</span><span class="um-field-control"><a href="javascript:void(0);" class="um-select-delete">'+wp.i18n.__("Remove","ultimate-member")+"</a></span></li>",e.append(t),e.find("li:last .um-hidden-multi-selects").attr("name",jQuery(this).data("name")).addClass("um-forms-field um-long-field").removeClass("um-hidden-multi-selects").attr("id",e.data("id_attr")+"-"+i))});var i,e=-(new Date).getTimezoneOffset()/60,t=(jQuery('input[name="um-gmt-offset"]').val(e),jQuery(".um-admin-metabox").find(".um-slider").each(function(){var e=jQuery(this),a=parseInt(e.data("min")),i=parseInt(e.data("max")),a=[a=void 0!==jQuery("#"+e.data("field_name")+"_min").val()?jQuery("#"+e.data("field_name")+"_min").val():a,i=void 0!==jQuery("#"+e.data("field_name")+"_max").val()?jQuery("#"+e.data("field_name")+"_max").val():i];e.slider({range:!0,min:parseInt(e.data("min")),max:parseInt(e.data("max")),values:a,create:function(e,a){},step:1,slide:function(e,a){s(jQuery(this),a)},stop:function(e,a){}}),s(e)}),!1);function s(e,a){var i,t="",s=e.siblings(".um-slider-range").data("placeholder-s"),l=e.siblings(".um-slider-range").data("placeholder-p"),a=a?(t=(a.values[0]===a.values[1]?s.replace("{value}",a.values[0]):l.replace("{min_range}",a.values[0]).replace("{max_range}",a.values[1])).replace("{field_label}",e.siblings(".um-slider-range").data("label")),i=a.values[0],a.values[1]):(t=(e.slider("values",0)===e.slider("values",1)?s.replace("{value}",e.slider("values",0)):l.replace("{min_range}",e.slider("values",0)).replace("{max_range}",e.slider("values",1))).replace("{field_label}",e.siblings(".um-slider-range").data("label")),i=e.slider("values",0),e.slider("values",1));e.siblings(".um-slider-range").html(t),e.siblings(".um_range_min").val(i),e.siblings(".um_range_max").val(a)}jQuery(document.body).on("change",".um-md-default-filters-option-line .um-field-wrapper select",function(){var i,e,a;t||(e=(i=jQuery(this)).val(),a=i.data("member_directory"),t=!0,wp.ajax.send("um_member_directory_default_filter_settings",{data:{key:e,directory_id:a,nonce:um_admin_scripts.nonce},success:function(e){var a=i.parents(".um-md-default-filters-option-line").find(".um-field-wrapper2");a.html(e.field_html),t=!1,a.find(".um-slider").each(function(){var e=jQuery(this),a=[parseInt(e.data("min")),parseInt(e.data("max"))];e.slider({range:!0,min:parseInt(e.data("min")),max:parseInt(e.data("max")),values:a,create:function(e,a){},step:1,slide:function(e,a){s(jQuery(this),a)},stop:function(e,a){}}),s(e)})},error:function(e){return!1}}))}),jQuery(".um-md-default-filters-add-option").on("click",function(){var e,a,i;t||((e=jQuery(this).siblings("ul.um-md-default-filters-list")).data("field_id"),(a=0)<e.find("li:last select.um-forms-field").length&&(a=+(a=e.find("li:last select.um-forms-field").attr("id").split("-"))[1]+1),i=jQuery("<div>").append(e.siblings(".um-hidden-md-default-filters").clone()).html(),e.append('<li class="um-md-default-filters-option-line"><span class="um-field-wrapper">'+i+'</span></span><span class="um-field-control"><a href="javascript:void(0);" class="um-select-delete">'+wp.i18n.__("Remove","ultimate-member")+'</a></span><span class="um-field-wrapper2 um"></li>'),e.find("li:last .um-hidden-md-default-filters").attr("name",jQuery(this).data("name")).addClass("um-forms-field um-long-field").removeClass("um-hidden-md-default-filters").attr("id",e.data("id_attr")+"-"+a),e.find("li:last .um-field-wrapper select").trigger("change"))}),jQuery(document.body).on("click",".um-text-delete",function(){jQuery(this).parents("li.um-multi-text-option-line").remove()}),jQuery(".um-multi-text-add-option").on("click",function(){var e=jQuery(this).siblings("ul.um-multi-text-list"),a=0,i=(0<e.find("li:last input.um-forms-field").length&&(a=+(a=e.find("li:last input.um-forms-field").attr("id").split("-"))[1]+1),jQuery("<div>").append(e.siblings(".um-hidden-multi-text").clone()).html()),t=e.data("item_class");e.append('<li class="'+t+'"><span class="um-field-wrapper">'+i+'</span><span class="um-field-control"><a href="javascript:void(0);" class="um-text-delete">'+wp.i18n.__("Remove","ultimate-member")+"</a></span></li>"),e.find("li:last .um-hidden-multi-text").attr("name",jQuery(this).data("name")).addClass("um-forms-field um-long-field").removeClass("um-hidden-multi-text").attr("id",e.data("id_attr")+"-"+a)}),jQuery(".um-media-upload").each(function(){var e=jQuery(this).find(".um-forms-field"),a=e.data("default");""!=e.val()&&e.val()!=a?(e.siblings(".um-set-image").hide(),e.siblings(".um-clear-image").show(),e.siblings(".icon_preview").show()):(e.val()==a&&e.siblings(".icon_preview").show(),e.siblings(".um-set-image").show(),e.siblings(".um-clear-image").hide())}),"undefined"!=typeof wp&&wp.media&&wp.media.editor&&(jQuery(".um-set-image").on("click",function(e){var a=jQuery(this);e.preventDefault(),i&&i.remove(),(i=wp.media({title:a.data("upload_frame"),button:{text:wp.i18n.__("Select","ultimate-member")},multiple:!1})).on("select",function(){var e=i.state().get("selection").first().toJSON();a.siblings(".icon_preview").attr("src",e.url).show(),a.siblings(".um-forms-field").val(e.url),a.siblings(".um-media-upload-data-id").val(e.id),a.siblings(".um-media-upload-data-width").val(e.width),a.siblings(".um-media-upload-data-height").val(e.height),a.siblings(".um-media-upload-data-thumbnail").val(e.thumbnail),a.siblings(".um-media-upload-data-url").trigger("change"),a.siblings(".um-media-upload-url").val(e.url),a.siblings(".um-clear-image").show(),a.hide(),jQuery(document).trigger("um_media_upload_select",[a,e])}),i.open()}),jQuery(".icon_preview").on("click",function(e){jQuery(this).siblings(".um-set-image").trigger("click")}),jQuery(".um-clear-image").on("click",function(e){var a=jQuery(this),i=a.siblings(".um-forms-field").data("default");a.siblings(".um-set-image").show(),a.hide(),a.siblings(".icon_preview").attr("src",i),a.siblings(".um-media-upload-data-id").val(""),a.siblings(".um-media-upload-data-width").val(""),a.siblings(".um-media-upload-data-height").val(""),a.siblings(".um-media-upload-data-thumbnail").val(""),a.siblings(".um-forms-field").val(i),a.siblings(".um-media-upload-data-url").trigger("change"),a.siblings(".um-media-upload-url").val(i),jQuery(document).trigger("um_media_upload_clear",a)})),jQuery(document.body).on("change",".um-forms-field",function(){(0<jQuery(".um-forms-line[data-conditional*='\""+jQuery(this).data("field_id")+"\",']").length||0<jQuery(".um-forms-line[data-conditional*='"+jQuery(this).data("field_id")+"|']").length||0<jQuery(".um-forms-line[data-conditional*='|"+jQuery(this).data("field_id")+"']").length)&&run_check_conditions()}),run_check_conditions()});