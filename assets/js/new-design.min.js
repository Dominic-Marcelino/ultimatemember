"object"!=typeof window.UM&&(window.UM={}),"object"!=typeof UM.profile&&(UM.profile={}),UM.profile={avatarModal:null,avatarCropper:null,avatarUploaderInit:function(){var r;jQuery(".um-profile-photo-uploader-overflow").each(function(){var e=jQuery(this),a=jQuery(this).data("user_id"),o=jQuery(this).data("nonce"),t=e.parents(".jb-uploader-dropzone"),i=(e.parents(".jb-select-media-button-wrapper"),t.siblings(".jb-uploader-errorlist")),o={browse_button:e.get(0),url:wp.ajax.settings.url+"?action=um_upload_profile_photo&user_id="+a+"&nonce="+o,chunk_size:"1024kb",max_retries:1,multipart:!0,multi_selection:!1,filters:{max_file_size:"10mb",mime_types:[{title:wp.i18n.__("Image files","ultimate-member"),extensions:"jpg,jpeg,gif,png,bmp,ico,tiff"}],prevent_duplicates:!0,max_file_count:1},init:{Error:function(e,o){i.html("<p>"+wp.i18n.__("Error!","ultimate-member")+" "+o.message+"</p>")},FileFiltered:function(r,e){i.empty(),r.getOption("multi_selection")||t.find(".jb-uploader-file").each(function(e,o){r.removeFile(o.id)})},FilesAdded:function(e,o){jQuery(".um-profile-photo").find(".um-profile-photo-overlay").show(),e.start()},FilesRemoved:function(e,o){$.each(o,function(e,o){jQuery("#"+o.id).remove()}),t.find(".jb-uploader-file").length||i.empty()},FileUploaded:function(e,o,r){var t;200===r.status&&r.response?(t=JSON.parse(r.response))?t.info&&0===t.OK?console.error(t.info):t.data&&((t={classes:"um-profile-photo-modal",duration:400,footer:"",header:wp.i18n.__("Change your profile photo","ultimate-member"),size:"normal",content:'<div class="um-profile-photo-crop-wrapper"><img src="'+t.data[0].url+'" class="um-profile-photo-crop" /></div><div class="um-modal-buttons-wrapper"><a href="javascript:void(0);" class="um-button um-button-primary um-apply-avatar-crop" data-user_id="'+a+'">'+wp.i18n.__("Apply","ultimate-member")+'</a><a class="um-button um-modal-avatar-decline" href="javascript:void(0);">'+wp.i18n.__("Cancel","ultimate-member")+"</a></div>"}).relatedButton=jQuery(".um-profile-photo").umModal(t),UM.profile.avatarModal=UM.modal.addModal(t,null)):i.append("<p>"+wp.i18n.__("Error! Wrong file upload server response.","ultimate-member")+"</p>"):console.error(wp.i18n.__("File was not loaded, Status Code %s","ultimate-member"),[r.status])},PostInit:function(e){t.find(".jb-uploader-file").remove()},UploadProgress:function(e,o){jQuery("#"+o.id).find("b").html("<span>"+o.percent+"%</span>")},UploadComplete:function(e,o){}}},o=wp.hooks.applyFilters("jb_job_uploader_filters_attrs",o,e);r=new plupload.Uploader(o),(r.id,r).init(),jQuery(this).parents(".jb-form-field-content").attr("data-uploader",r.id)})}},jQuery(document).ready(function(e){jQuery(document.body).on("click",".um-apply-avatar-crop",function(e){e.preventDefault();var r,e=jQuery(this),o=jQuery(this).attr("data-key"),t=jQuery(this).parents(".um-modal-body").find(".um-single-image-preview"),a=UM.profile.avatarCropper.cropper("getData"),t=(t.find("img").data("file"),e.data("user_id"));1===jQuery('div.um-field-image[data-key="'+o+'"]').length&&((e=jQuery('div.um-field-image[data-key="'+o+'"]').closest(".um-form")).find('input[name="form_id"]').val(),e.attr("data-mode")),a&&(jQuery(this).html(jQuery(this).attr("data-processing")).addClass("disabled"),wp.ajax.send("um_resize_avatar",{data:{coord:a,user_id:t},success:function(o){r=new Date,jQuery(".um-profile-photo img").attr("src",o.avatar+"?"+r.getTime()),jQuery(".um-profile-photo").find(".um-profile-photo-overlay").hide(),jQuery(".um-profile-photo").find(".um-new-dropdown").find("li").hide(),jQuery.each(o.actions,function(e){jQuery(".um-profile-photo").find(".um-new-dropdown").find("."+o.actions[e]).parents("li").show()}),null!==UM.profile.avatarCropper&&UM.profile.avatarCropper.cropper("destroy"),UM.modal.destroy(UM.profile.avatarModal)},error:function(e){console.log(e)}}))}),jQuery(document.body).on("click",".um-modal-avatar-decline",function(e){e.preventDefault(),null!==UM.profile.avatarCropper&&UM.profile.avatarCropper.cropper("destroy"),UM.modal.destroy(UM.profile.avatarModal),jQuery(".um-profile-photo").find(".um-profile-photo-overlay").hide()})}),jQuery(document).ready(function(r){UM.profile.avatarUploaderInit(),r(document.body).on("click",".um-reset-profile-photo",function(e){e.preventDefault;var e=r(this).data("user_id"),o=r(this).data("nonce");jQuery(".um-profile-photo").find(".um-profile-photo-overlay").show(),wp.ajax.send("um_delete_profile_photo",{data:{user_id:e,nonce:o},success:function(o){jQuery(".um-profile-photo").find(".avatar").replaceWith(o.avatar),jQuery(".um-profile-photo").find(".um-new-dropdown").find("li").hide(),jQuery.each(o.actions,function(e){jQuery(".um-profile-photo").find(".um-new-dropdown").find("."+o.actions[e]).parents("li").show()}),jQuery(".um-profile-photo").find(".um-profile-photo-overlay").hide()},error:function(e){console.log(e)}})})});